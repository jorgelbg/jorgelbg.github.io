<!doctype html><html lang=en-us><head><link rel=preload href=//jorgelbg.me/css/style.css as=style><link rel=stylesheet href=//jorgelbg.me/css/style.css media=print onload="this.media='all'"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jorge Luis Betancourt"><meta name=description content="Computo Ergo Sum"><meta name=generator content="Hugo 0.80.0"><title>Introducing pinentry-touchid</title><link rel="shortcut icon" href=//jorgelbg.me/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=//jorgelbg.me/site.webmanifest><link rel=mask-icon href=//jorgelbg.me/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=dns-prefetch href=//www.google-analytics.com/><link href=//jorgelbg.me/index.xml rel=alternate type=application/rss+xml title="Jorge Luis Betancourt"><meta property="og:title" content="Introducing pinentry-touchid"><meta property="og:description" content="Introducing `pinentry-touchid` a small pinentry program that verifies the identity of the user via the Touch ID sensor in supported devices."><meta property="og:type" content="article"><meta property="og:url" content="//jorgelbg.me/2021/08/introducing-pinentry-touchid/"><meta property="og:image" content="//jorgelbg.me/images/pinentry-touchid/login.png"><meta property="article:published_time" content="2021-08-03T14:00:00+02:00"><meta property="article:modified_time" content="2021-08-12T16:20:38+02:00"><meta itemprop=name content="Introducing pinentry-touchid"><meta itemprop=description content="Introducing `pinentry-touchid` a small pinentry program that verifies the identity of the user via the Touch ID sensor in supported devices."><meta itemprop=datePublished content="2021-08-03T14:00:00+02:00"><meta itemprop=dateModified content="2021-08-12T16:20:38+02:00"><meta itemprop=wordCount content="582"><meta itemprop=image content="//jorgelbg.me/images/pinentry-touchid/login.png"><meta itemprop=keywords content="pinentry,touchid,gpg,mac,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="//jorgelbg.me/images/pinentry-touchid/login.png"><meta name=twitter:title content="Introducing pinentry-touchid"><meta name=twitter:description content="Introducing `pinentry-touchid` a small pinentry program that verifies the identity of the user via the Touch ID sensor in supported devices."><meta name=twitter:site content="@jorgelbg"></head><body><section id=wrapper><nav class=main-nav><a href=//jorgelbg.me></a></nav><article class=post><header><h1><a href=//jorgelbg.me/2021/08/introducing-pinentry-touchid/><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>Introducing pinentry-touchid</a></h1><h2 class=headline><span>August 3, 2021</span>
<span class=tag><svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98.0 012 12V7a5 5 0 015-5h4.99c.53.0 1.04.2 1.42.59l8 8a2 2 0 010 2.82l-8 8a2 2 0 01-2.82.0l-8-8zM20 12l-8-8H7A3 3 0 004 7v5l8 8 8-8zM7 8a1 1 0 110-2 1 1 0 010 2z"/></svg><a style=margin-left:10px href=//jorgelbg.me/tags/pinentry>pinentry</a></span>
<span class=tag><svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98.0 012 12V7a5 5 0 015-5h4.99c.53.0 1.04.2 1.42.59l8 8a2 2 0 010 2.82l-8 8a2 2 0 01-2.82.0l-8-8zM20 12l-8-8H7A3 3 0 004 7v5l8 8 8-8zM7 8a1 1 0 110-2 1 1 0 010 2z"/></svg><a style=margin-left:10px href=//jorgelbg.me/tags/touchid>touchid</a></span>
<span class=tag><svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98.0 012 12V7a5 5 0 015-5h4.99c.53.0 1.04.2 1.42.59l8 8a2 2 0 010 2.82l-8 8a2 2 0 01-2.82.0l-8-8zM20 12l-8-8H7A3 3 0 004 7v5l8 8 8-8zM7 8a1 1 0 110-2 1 1 0 010 2z"/></svg><a style=margin-left:10px href=//jorgelbg.me/tags/gpg>gpg</a></span>
<span class=tag><svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98.0 012 12V7a5 5 0 015-5h4.99c.53.0 1.04.2 1.42.59l8 8a2 2 0 010 2.82l-8 8a2 2 0 01-2.82.0l-8-8zM20 12l-8-8H7A3 3 0 004 7v5l8 8 8-8zM7 8a1 1 0 110-2 1 1 0 010 2z"/></svg><a style=margin-left:10px href=//jorgelbg.me/tags/mac>mac</a></span></h2><p class=last-edited><a href=https://github.com/jorgelbg/jorgelbg.github.io/commit/c610c4c6ef9a07c7c88028667387831ea0de0e00 title="Try to generate a proper twitter card for the articles">Last edited on 12 August 2021</a></p></header><section id=post-body><picture>
<source type=image/webp srcset=/images/pinentry-touchid/login.webp><source type=image/png srcset=/images/pinentry-touchid/login.png><img src=/images/pinentry-touchid/login.png class=align-center alt="secure login image" loading=lazy style=max-width:100%></picture><h2 id=summary>Summary</h2><p>This post introduces <a href=https://github.com/jorgelbg/pinentry-touchid>pinentry-touchid</a>, a wrapper of <a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a>
that uses Touch ID for accessing your PIN/password from the Keychain. It will help you avoid typing
your password when interacting with your GPG keys (like when you sign a Git commit).</p><h2 id=see-it-in-action>See it in action</h2><p>Here is a short clip on how <a href=https://github.com/jorgelbg/pinentry-touchid>pinentry-touchid</a> works (after configuring the
gpg-agent):</p><video width=100% controls autoplay>
<source src=/images/pinentry-touchid/pinentry-touchid.mp4 type=video/mp4>Your browser does not support the video tag.</video><h2 id=installation>Installation</h2><p>It is possible to install <a href=https://github.com/jorgelbg/pinentry-touchid>pinentry-touchid</a> using Homebrew:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>‚ùØ brew tap jorgelbg/tap
‚ùØ brew install pinentry-touchid
</code></pre></div><p>You can also download the binaries directly from our <a href=https://github.com/jorgelbg/pinentry-touchid/releases>releases</a> page.</p><h2 id=a-bit-of-history>A bit of history</h2><p>I use GPG to sign my commits. So far, I‚Äôve been using either pinentry-curses or the pinentry-mac for
typing my pin/password, when it is requested.</p><p>Since I got a Touch ID capable computer I&rsquo;ve been enjoying the sweet life of Touch ID. The
use of Touch ID has spread on the macOS ecosystem and a lot of popular apps like 1Password support Touch
ID. Getting passwords autocompleted with 1Password is a breeze, I have to type 0 passwords, while
still getting a confirmation that it is me requesting the password, via Touch ID.</p><p>I also use <a href=https://github.com/gopasspw/gopass><code>gopass</code></a> for storing tokens/secrets that I normally need in the shell. The main
reason for this is that it integrates nicely with the shell/terminal, even more than 1Password.
<a href=https://github.com/gopasspw/gopass><code>gopass</code></a> makes using secrets in environment variables a breeze.</p><p>For instance, my environment is full of commands like this:</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=err>‚ùØ</span> <span class=kr>export</span> <span class=nx>GITHUB_API_TOKEN</span><span class=o>=</span><span class=nx>$</span><span class=p>(</span><span class=nx>gopass</span> <span class=nx>github</span><span class=o>/</span><span class=nx>mytoken</span><span class=p>)</span>
</code></pre></div><p>Since <a href=https://github.com/gopasspw/gopass><code>gopass</code></a> uses a GPG key for encrypting the secrets I type my pin/password quite
often. As I say to my friends, I am a lazy driven developer üòÇ:</p><blockquote><p>&mldr; the essence is to identify what is painful and then eliminate the pain.</p><p><a href=https://humblesoftwaredev.wordpress.com/2015/04/08/laziness-driven-development/>https://humblesoftwaredev.wordpress.com/2015/04/08/laziness-driven-development/</a></p></blockquote><p>Typing my password all the time falls into the <em>painful/repetitive</em> category for me. Yes, I could
increase the amount of time that the gpg-agent caches the password but that would be just a patch.
Turns out that this Macbook Pro already has something that would allow me to avoid typing the
password every single time: the Touch ID sensor.</p><p>It would be awesome if I could use Touch ID for getting the pin/password of my GPG key.
Unsurprisingly, I‚Äôm not the first person to want this. A simple Google search reveals multiple
<a href=https://gpgtools.tenderapp.com/discussions/feedback/15650-pinentry-mac-use-apple-watch-touchid-to-unlock-gpg-key>users</a> <a href=https://superuser.com/questions/1461868/is-it-possible-to-use-macos-keychain-touchid-for-pinentry-program>requesting</a> <a href=https://twitter.com/adamyonk/status/808406995770413056>this</a>. Sadly, it is not supported yet by <a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a>.</p><p><a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a> already supports storing the pin/password in the macOS Keychain, but
accessing the entry does not use Touch ID. I ended up writing a small wrapper that saves the pin in
the macOS Keychain (following the same format as the default <a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a>) but guards
every access with Touch ID. It is backward compatible with <a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a> and calls
<a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a> for requesting a password from the user when there is no entry in the
Keychain for the given GPG key.</p><p>This was an interesting project, I learned a bit about <a href=https://www.gnupg.org/documentation/manuals/assuan>Assuan</a>, the IPC protocol used by the
gpp-agent to communicate with any pinentry-like program.</p><h2 id=caveats>Caveats</h2><p>The current version does not store the password in the <a href=https://support.apple.com/en-gb/guide/security/sec59b0b31ff/web>Secure
Enclave</a> of your device. This
allowed us to reuse the same Keychain entry created by <a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a>, if present. At
the same time, the entry created by <a href=https://github.com/jorgelbg/pinentry-touchid>pinentry-touchid</a> can be used by
<a href=https://github.com/GPGTools/pinentry/tree/master/macosx>pinentry-mac</a> keeping compatibility between both programs. Also,
<a href=https://github.com/keybase/go-keychain>go-keychain</a> does not offer support for the secure enclave (yet).</p><h2 id=acknowledgments>Acknowledgments</h2><p>Finally, I would like to say thank you to the authors and contributors of <a href=https://github.com/foxcpp/go-assuan>go-assuan</a>,
<a href=https://github.com/keybase/go-keychain>go-keychain</a>, <a href=github.com/gopasspw/pinentry>gopass</a> and <a href=https://github.com/lox/go-touchid>go-touchid</a>.</p><p><em>Touch ID icon made by <a href=https://www.freepik.com>Freepik</a> from <a href=https://www.flaticon.com/>Flaticon</a>.</em></p></section></article><footer id=post-meta class=clearfix><svg class="avatar" width="50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#cbd5e0" d="M20.3 12.04l1.01 3a1 1 0 01-1.26 1.27l-3.01-1a7 7 0 113.27-3.27zM11 10a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2z"/><path fill="#4a5568" d="M15.88 17.8a7 7 0 01-8.92 2.5l-3 1.01a1 1 0 01-1.27-1.26l1-3.01A6.97 6.97.0 015 9.1a9 9 0 0010.88 8.7z"/></svg><a href=https://twitter.com/jorgelbg><div><span class=dark>Want to leave a comment?</span>
<span>Drop me a message on Twitter @jorgelbg</span></div></a><section id=sharing><a class=twitter target=_blank href="https://twitter.com/intent/tweet?text=%2f%2fjorgelbg.me%2f2021%2f08%2fintroducing-pinentry-touchid%2f - Introducing%20pinentry-touchid by @jorgelbg"><span class=icon-twitter>tweet</span></a></section></footer><ul id=post-list class="archive readmore"><h3>Read more</h3><li><a href=//jorgelbg.me/2020/03/displaying-geohash-tags-from-a-loki-datasource-in-a-grafana-worldmap-panel/><span>Displaying geohash tags from a Loki datasource in a Grafana Worldmap Panel</span><aside class=dates>Mar 18 2020</aside></a></li><li><a href=//jorgelbg.me/2020/02/web-ui-for-testing-dissect-patterns/><span>Web UI for testing dissect patterns</span><aside class=dates>Feb 21 2020</aside></a></li><li><a href=//jorgelbg.me/2020/01/better-url-search-with-elasticsearch/><span>Better URL search with Elasticsearch</span><aside class=dates>Jan 1 2020</aside></a></li></ul><footer id=footer><p class=small>¬© Copyright 2021 Jorge Luis Betancourt</p><p class="small cc">Icons made by
<a href=https://www.freepik.com/ title=Freepik>Freepik</a> from
<a href=https://www.flaticon.com/ title=Flaticon>www.flaticon.com</a> is
licensed by
<a href=https://creativecommons.org/licenses/by/3.0/ title="Creative Commons BY 3.0" target=_blank>CC 3.0 BY</a></p></footer></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-115201846-1','auto');ga('send','pageview');}</script></body></html>