<!DOCTYPE html>
<html lang="en-us">
<head>
<link rel="preload" href="//jorgelbg.me/css/style.css" as="style">
<link rel="stylesheet" href="//jorgelbg.me/css/style.css" media="print" onload="this.media='all'">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Jorge Luis Betancourt">
<meta name="description" content="Computo Ergo Sum">
<meta name="generator" content="Hugo 0.57.0" />
<title>Display the application&#39;s version in your Grafana dashboards</title>
<link rel="shortcut icon" href="//jorgelbg.me/images/favicon.ico">
<link rel="dns-prefetch" href="//www.google-analytics.com/" />



<link href="//jorgelbg.me/index.xml" rel="alternate" type="application/rss+xml" title="Jorge Luis Betancourt" />


<meta property="og:title" content="Display the application&#39;s version in your Grafana dashboards" />
<meta property="og:description" content="Nice &#34;trick&#34; to visualize the version of your application in your Grafana dashboards.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//jorgelbg.me/2019/02/display-the-applications-version-in-your-grafana-dashboards/" />
<meta property="article:published_time" content="2019-02-17T14:00:28+01:00" />
<meta property="article:modified_time" content="2019-02-17T14:00:28+01:00" />


<meta itemprop="name" content="Display the application&#39;s version in your Grafana dashboards">
<meta itemprop="description" content="Nice &#34;trick&#34; to visualize the version of your application in your Grafana dashboards.
">


<meta itemprop="datePublished" content="2019-02-17T14:00:28&#43;01:00" />
<meta itemprop="dateModified" content="2019-02-17T14:00:28&#43;01:00" />
<meta itemprop="wordCount" content="614">



<meta itemprop="keywords" content="prometheus,grafana," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Display the application&#39;s version in your Grafana dashboards"/>
<meta name="twitter:description" content="Nice &#34;trick&#34; to visualize the version of your application in your Grafana dashboards.
"/>
<meta name="twitter:site" content="@https://twitter.com/jorgelbg"/>


</head>
<body>
    
    <section id="wrapper">
        <nav class="main-nav">
	
		<a href='//jorgelbg.me'>
			
			
			<svg fill="#718096" xmlns="http://www.w3.org/2000/svg" width="48" viewBox="0 0 24 24" height="48"><path class="heroicon-ui" d="M13 20v-5h-2v5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7.59l-.3.3a1 1 0 1 1-1.4-1.42l9-9a1 1 0 0 1 1.4 0l9 9a1 1 0 0 1-1.4 1.42l-.3-.3V20a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2zm5 0v-9.59l-6-6-6 6V20h3v-5c0-1.1.9-2 2-2h2a2 2 0 0 1 2 2v5h3z"/></svg>
			
		</a>
	

	

	
</nav>

        
<article class="post">
    <header>
        <h1>
            <a href="/2019/02/display-the-applications-version-in-your-grafana-dashboards/">
            <svg width="30" xmlns="http://www.w3.org/2000/svg" version="1" viewBox="0 0 483 483"><path d="M255 209c-5 6-5 14 0 19 22 22 22 58 0 80L140 423a56 56 0 0 1-79 0l-18-17a56 56 0 0 1 0-80l115-115c6-5 6-14 1-19s-14-5-20 0L24 307a83 83 0 0 0 0 118l18 17a83 83 0 0 0 117 0l115-115c33-32 33-85 0-118-5-5-13-5-19 0z"/><path d="M459 58l-18-17a83 83 0 0 0-117 0L209 156a83 83 0 0 0 0 118c5 5 13 5 19 0s5-14 0-20a56 56 0 0 1 0-79L343 60c22-22 57-22 79 0l17 17c22 22 22 58 0 80L324 272c-5 5-5 13 0 19 3 2 7 4 10 4s7-1 9-4l115-115a83 83 0 0 0 1-118z"/></svg>
            Display the application&#39;s version in your Grafana dashboards
        </a></h1>
        <h2 class="headline">
            February 17, 2019
            <br>
            <br>
            
            
                
                <span class="tag">
                    <svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98 0 0 1 2 12V7a5 5 0 0 1 5-5h4.99c.53 0 1.04.2 1.42.59l8 8a2 2 0 0 1 0 2.82l-8 8a2 2 0 0 1-2.82 0l-8-8zM20 12l-8-8H7a3 3 0 0 0-3 3v5l8 8 8-8zM7 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></svg>
                    <a style="margin-left: 10px;" href="//jorgelbg.me/tags/prometheus">prometheus</a>
                </span>
                
                <span class="tag">
                    <svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98 0 0 1 2 12V7a5 5 0 0 1 5-5h4.99c.53 0 1.04.2 1.42.59l8 8a2 2 0 0 1 0 2.82l-8 8a2 2 0 0 1-2.82 0l-8-8zM20 12l-8-8H7a3 3 0 0 0-3 3v5l8 8 8-8zM7 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></svg>
                    <a style="margin-left: 10px;" href="//jorgelbg.me/tags/grafana">grafana</a>
                </span>
                
            
            
        </h2>
    </header>
    <section id="post-body">
        

<p>At work, we needed a way to monitor the lag of some Kafka consumers reading
business-critical topics.</p>

<p>We ended up using <a href="https://github.com/danielqsj/kafka_exporter/">this exporter</a>
that provided exactly the metrics that we needed. After adding <a href="https://github.com/danielqsj/kafka_exporter/pull/75">metadata caching</a>
to reduce the load on our Kafka cluster we deployed the exporter to our Nomad
cluster and started to build dashboards.</p>

<p>While I was making changes to the application. I needed not only to check the
logs but also to graph the data that the exporter was getting from Kafka, to
make sure that my changes were not breaking the normal behavior. Yes,
I love metrics and <a href="http://jorgelbg.github.io/posts/logs-metrics-for-small-data/">I create graphs even while writing code üòÇ</a>.</p>

<p>In Prometheus, if you&rsquo;re not careful, you can break the continuity of your series if
you <a href="https://promcon.io/2017-munich/slides/best-practices-and-beastly-pitfalls.pdf">use non-identifying labels</a>.
Joining extra info from a separate <a href="https://www.robustperception.io/how-to-have-labels-for-machine-roles">metric is the preferred way</a>.
The developers of this exporter were kind enough to provide a special metric called
<code>build_info</code>. This metric provides some metadata about the current build as a set
of labels and has a constant value of <code>1</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># HELP kafka_exporter_build_info A metric with a constant &#39;1&#39; value labeled by version, revision, branch, and goversion from which kafka_exporter was built.</span>
<span class="c1"># TYPE kafka_exporter_build_info gauge</span>
kafka_exporter_build_info<span class="o">{</span>
    <span class="nv">branch</span><span class="o">=</span><span class="s2">&#34;metadata-cache&#34;</span>,
    <span class="nv">goversion</span><span class="o">=</span><span class="s2">&#34;go1.11.5&#34;</span>,
    <span class="nv">revision</span><span class="o">=</span><span class="s2">&#34;b33d679353e0a1f7b521c7d6d4461e33913b9efe&#34;</span>,
    <span class="nv">version</span><span class="o">=</span><span class="s2">&#34;1.2.0&#34;</span>
<span class="o">}</span> <span class="m">1</span></code></pre></div>
<p>The idea of exposing the software version to <a href="https://www.robustperception.io/exposing-the-software-version-to-prometheus">prometheus is not new</a>.
And in fact, it is a common practice among Prometheus exporters.</p>

<p>The difference is that in this case, I didn&rsquo;t want to &ldquo;join&rdquo; my metrics with the
build data. I just wanted to show the build info in a useful way in Grafana.
That&rsquo;s why I didn&rsquo;t use the <a href="https://www.robustperception.io/exposing-the-software-version-to-prometheus">this approach</a>.</p>

<h2 id="grafana">Grafana</h2>

<p><a href="https://grafana.com/">Grafana</a> supports visualizing several queries in the
same Panel. So I only needed to show the <code>kafka_exporter_build_info</code> as a new
metric and make it <em>visible</em> in some way.</p>

<p>I ended up using the following query:</p>

<pre><code>kafka_exporter_build_info-1
</code></pre>

<p>Because the <code>kafka_exporter_build_info</code> has a constant value of <code>1</code> and only
the labels are changing. The value of this query is always going to be <code>0</code>.</p>

<blockquote>
<p>‚ö†Ô∏è I didn&rsquo;t have several versions of the same software
running.</p>
</blockquote>

<h2 id="the-visualization">The visualization</h2>

<p>After this I configured the metric&rsquo;s Legend format to be: <code>build {{ revision}}</code>.
<code>revision</code> is the git commit hash at build time of the deployed binary.
All the series generated by this metric are going to start with the <code>build</code>
prefix.</p>

<p>Now, I only needed to override how this specific series was shown in my panel.
<a href="http://docs.grafana.org/v5.3/features/panels/graph/#series-overrides">Grafana supports series overrides</a>,
meaning changing certain aspects of a series while keeping the rest of the
styles untouched.</p>

<p>Using this feature we can add an override for all series that start with the
<code>build</code> prefix using the <code>/build.*/</code> regex. And then change some settings,
like:</p>

<ul>
<li>Line: true (always show a line for this series)</li>
<li>Line width: 6 (let&rsquo;s use a thick line)</li>
<li>Points: false (never show any points)</li>
</ul>

<p><img src="/images/app-version-in-grafana/series-override.png" alt="Series Override" title="Overrides applied to the build series" /></p>

<p>Setting these options allows us to change the rest of the panel display
settings disregarding how it will affect the build series.</p>

<p>The end result looks like this:</p>

<p><img src="/images/app-version-in-grafana/final-result.png" alt="The end result" title="How it looked in the end" /></p>

<p>As a bonus, you can see how the last deployed version fixed some issues with
missing metrics</p>

<h2 id="summary">Summary</h2>

<p>A thick line at the <code>0</code> value of the graph always shows the version that I&rsquo;m
using. It is visible in the legend and a change in the color indicates that
a new version has been deployed.</p>

<p>The change in the color provides nice visual feedback when a new version is
deployed. And yet, it is not intrusive to whatever you&rsquo;re showing in your
graph. It is self-contained, you can change the appearance of your graph
without affecting this particular series. Finally, this approach doesn&rsquo;t
require that your queries are &ldquo;aware&rdquo; of the build information.</p>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    <svg class="avatar" width="50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path fill="#CBD5E0" d="M20.3 12.04l1.01 3a1 1 0 0 1-1.26 1.27l-3.01-1a7 7 0 1 1 3.27-3.27zM11 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
        <path fill="#4A5568" d="M15.88 17.8a7 7 0 0 1-8.92 2.5l-3 1.01a1 1 0 0 1-1.27-1.26l1-3.01A6.97 6.97 0 0 1 5 9.1a9 9 0 0 0 10.88 8.7z"></path>
    </svg>
    <a href="https://twitter.com/jorgelbg">
    
    <div>
        
        
        <span class="dark">Want to leave a comment?</span>
        <span>Drop me a message on Twitter @jorgelbg </span>
    </div>
    </a>
    <section id="sharing">
        <a class="twitter" target="_blank" href="https://twitter.com/intent/tweet?text=%2f%2fjorgelbg.me%2f2019%2f02%2fdisplay-the-applications-version-in-your-grafana-dashboards%2f - Display%20the%20application%27s%20version%20in%20your%20Grafana%20dashboards by @jorgelbg"><span class="icon-twitter"> tweet</span></a>



    </section>
</footer>



<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="/2019/05/how-to-rename-index-patterns-in-kibana/">How to rename index patterns in Kibana<aside class="dates">May 21 2019</aside></a>
        </li>
    
        <li>
            <a href="/2019/03/useful-alerts-with-elastic-watcher-machine-learning/">Useful alerts with Elastic Watcher &amp; Machine Learning<aside class="dates">Mar 15 2019</aside></a>
        </li>
    
        <li>
            <a href="/2018/12/optimize-grafana-dashboards-with-elasticsearch-index-aliases/">Optimize Grafana dashboards with Elasticsearch index aliases<aside class="dates">Dec 20 2018</aside></a>
        </li>
    
</ul>


        <footer id="footer">
  <p class="small">
    
    ¬© Copyright 2019 Jorge Luis Betancourt
    
  </p>
  <p class="small cc">
    Icons made by
    <a href="https://www.freepik.com/" title="Freepik">Freepik</a> from
    <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is
    licensed by
    <a href="https://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a>
  </p>
</footer>

    </section>
    


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-115201846-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
