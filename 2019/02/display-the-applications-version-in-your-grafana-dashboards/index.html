<!doctype html><html lang=en-us><head><link rel=preload href=//jorgelbg.me/css/style.css as=style><link rel=stylesheet href=//jorgelbg.me/css/style.css media=print onload="this.media='all'"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jorge Luis Betancourt"><meta name=description content="Computo Ergo Sum"><meta name=generator content="Hugo 0.60.1"><title>Display the application's version in your Grafana dashboards</title><link rel="shortcut icon" href=//jorgelbg.me/images/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=dns-prefetch href=//www.google-analytics.com/><link href=//jorgelbg.me/index.xml rel=alternate type=application/rss+xml title="Jorge Luis Betancourt"><meta property="og:title" content="Display the application's version in your Grafana dashboards"><meta property="og:description" content="Nice &#34;trick&#34; to visualize the version of your application in your Grafana dashboards."><meta property="og:type" content="article"><meta property="og:url" content="//jorgelbg.me/2019/02/display-the-applications-version-in-your-grafana-dashboards/"><meta property="article:published_time" content="2019-02-17T14:00:28+01:00"><meta property="article:modified_time" content="2019-07-30T20:18:31+02:00"><meta itemprop=name content="Display the application's version in your Grafana dashboards"><meta itemprop=description content="Nice &#34;trick&#34; to visualize the version of your application in your Grafana dashboards."><meta itemprop=datePublished content="2019-02-17T14:00:28+01:00"><meta itemprop=dateModified content="2019-07-30T20:18:31+02:00"><meta itemprop=wordCount content="614"><meta itemprop=keywords content="prometheus,grafana,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Display the application's version in your Grafana dashboards"><meta name=twitter:description content="Nice &#34;trick&#34; to visualize the version of your application in your Grafana dashboards."><meta name=twitter:site content="@https://twitter.com/jorgelbg"></head><body><section id=wrapper><nav class=main-nav><a href=//jorgelbg.me></a></nav><article class=post><header><h1><a href=//jorgelbg.me/2019/02/display-the-applications-version-in-your-grafana-dashboards/><svg width="24" viewBox="0 0 512.1 512.1"><path d="M312 2e2c-6-7-12-12-20-17a119 119 0 00-149 17L35 308a119 119 0 00169 169l89-89a9 9 0 00-6-15h-3c-19 0-37-3-55-10-3-2-7-1-9 1l-64 65a51 51 0 11-73-73l109-108c20-20 53-20 72 0 14 12 35 12 48 0 6-6 10-14 10-22 1-10-3-19-10-26z"/><path d="M477 35c-47-47-122-47-169 0l-89 89a9 9 0 006 15h3c19 0 37 4 55 11 3 1 6 0 9-2l64-64a51 51 0 1173 72l-81 80v1l-28 28a51 51 0 01-73 0 35 35 0 00-48 0 34 34 0 000 48c10 10 22 18 35 24l5 2 5 2 6 2 5 1a138 138 0 0023 3h12l6-1h8l3-1 5-1h1c21-5 40-16 55-31l109-109c47-47 47-122 0-169z"/></svg>Display the application's version in your Grafana dashboards</a></h1><h2 class=headline><span>February 17, 2019</span>
<span class=tag><svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98.0 012 12V7a5 5 0 015-5h4.99c.53.0 1.04.2 1.42.59l8 8a2 2 0 010 2.82l-8 8a2 2 0 01-2.82.0l-8-8zM20 12l-8-8H7A3 3 0 004 7v5l8 8 8-8zM7 8a1 1 0 110-2 1 1 0 010 2z"/></svg><a style=margin-left:10px href=//jorgelbg.me/tags/prometheus>prometheus</a></span>
<span class=tag><svg fill="#718096" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path class="heroicon-ui" d="M2.59 13.41A1.98 1.98.0 012 12V7a5 5 0 015-5h4.99c.53.0 1.04.2 1.42.59l8 8a2 2 0 010 2.82l-8 8a2 2 0 01-2.82.0l-8-8zM20 12l-8-8H7A3 3 0 004 7v5l8 8 8-8zM7 8a1 1 0 110-2 1 1 0 010 2z"/></svg><a style=margin-left:10px href=//jorgelbg.me/tags/grafana>grafana</a></span></h2><p class=last-edited><a href=https://github.com/jorgelbg/jorgelbg.github.io/commit/9331eb213beaded471bf23f34d186db71477059d title="Some style fixes (#19)">Last edited on 30 July 2019</a></p></header><section id=post-body><p>At work, we needed a way to monitor the lag of some Kafka consumers reading
business-critical topics.</p><p>We ended up using <a href=https://github.com/danielqsj/kafka_exporter/>this exporter</a>
that provided exactly the metrics that we needed. After adding <a href=https://github.com/danielqsj/kafka_exporter/pull/75>metadata caching</a>
to reduce the load on our Kafka cluster we deployed the exporter to our Nomad
cluster and started to build dashboards.</p><p>While I was making changes to the application. I needed not only to check the
logs but also to graph the data that the exporter was getting from Kafka, to
make sure that my changes were not breaking the normal behavior. Yes,
I love metrics and <a href=http://jorgelbg.github.io/posts/logs-metrics-for-small-data/>I create graphs even while writing code üòÇ</a>.</p><p>In Prometheus, if you're not careful, you can break the continuity of your series if
you <a href=https://promcon.io/2017-munich/slides/best-practices-and-beastly-pitfalls.pdf>use non-identifying labels</a>.
Joining extra info from a separate <a href=https://www.robustperception.io/how-to-have-labels-for-machine-roles>metric is the preferred way</a>.
The developers of this exporter were kind enough to provide a special metric called
<code>build_info</code>. This metric provides some metadata about the current build as a set
of labels and has a constant value of <code>1</code>:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=c1># HELP kafka_exporter_build_info A metric with a constant &#39;1&#39; value labeled by version, revision, branch, and goversion from which kafka_exporter was built.</span>
<span class=c1># TYPE kafka_exporter_build_info gauge</span>
kafka_exporter_build_info<span class=o>{</span>
    <span class=nv>branch</span><span class=o>=</span><span class=s2>&#34;metadata-cache&#34;</span>,
    <span class=nv>goversion</span><span class=o>=</span><span class=s2>&#34;go1.11.5&#34;</span>,
    <span class=nv>revision</span><span class=o>=</span><span class=s2>&#34;b33d679353e0a1f7b521c7d6d4461e33913b9efe&#34;</span>,
    <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.2.0&#34;</span>
<span class=o>}</span> <span class=m>1</span>
</code></pre></div><p>The idea of exposing the software version to <a href=https://www.robustperception.io/exposing-the-software-version-to-prometheus>prometheus is not new</a>.
And in fact, it is a common practice among Prometheus exporters.</p><p>The difference is that in this case, I didn't want to &ldquo;join&rdquo; my metrics with the
build data. I just wanted to show the build info in a useful way in Grafana.
That's why I didn't use the <a href=https://www.robustperception.io/exposing-the-software-version-to-prometheus>this approach</a>.</p><h2 id=grafana>Grafana</h2><p><a href=https://grafana.com/>Grafana</a> supports visualizing several queries in the
same Panel. So I only needed to show the <code>kafka_exporter_build_info</code> as a new
metric and make it <em>visible</em> in some way.</p><p>I ended up using the following query:</p><pre><code>kafka_exporter_build_info-1
</code></pre><p>Because the <code>kafka_exporter_build_info</code> has a constant value of <code>1</code> and only
the labels are changing. The value of this query is always going to be <code>0</code>.</p><blockquote><p>‚ö†Ô∏è I didn't have several versions of the same software
running.</p></blockquote><h2 id=the-visualization>The visualization</h2><p>After this I configured the metric's Legend format to be: <code>build {{ revision}}</code>.
<code>revision</code> is the git commit hash at build time of the deployed binary.
All the series generated by this metric are going to start with the <code>build</code>
prefix.</p><p>Now, I only needed to override how this specific series was shown in my panel.
<a href=http://docs.grafana.org/v5.3/features/panels/graph/#series-overrides>Grafana supports series overrides</a>,
meaning changing certain aspects of a series while keeping the rest of the
styles untouched.</p><p>Using this feature we can add an override for all series that start with the
<code>build</code> prefix using the <code>/build.*/</code> regex. And then change some settings,
like:</p><ul><li>Line: true (always show a line for this series)</li><li>Line width: 6 (let's use a thick line)</li><li>Points: false (never show any points)</li></ul><p><img src=/images/app-version-in-grafana/series-override.png alt="Series Override" title="Overrides applied to the build series"></p><p>Setting these options allows us to change the rest of the panel display
settings disregarding how it will affect the build series.</p><p>The end result looks like this:</p><p><img src=/images/app-version-in-grafana/final-result.png alt="The end result" title="How it looked in the end"></p><p>As a bonus, you can see how the last deployed version fixed some issues with
missing metrics</p><h2 id=summary>Summary</h2><p>A thick line at the <code>0</code> value of the graph always shows the version that I'm
using. It is visible in the legend and a change in the color indicates that
a new version has been deployed.</p><p>The change in the color provides nice visual feedback when a new version is
deployed. And yet, it is not intrusive to whatever you're showing in your
graph. It is self-contained, you can change the appearance of your graph
without affecting this particular series. Finally, this approach doesn't
require that your queries are &ldquo;aware&rdquo; of the build information.</p></section></article><footer id=post-meta class=clearfix><svg class="avatar" width="50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#cbd5e0" d="M20.3 12.04l1.01 3a1 1 0 01-1.26 1.27l-3.01-1a7 7 0 113.27-3.27zM11 10a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2z"/><path fill="#4a5568" d="M15.88 17.8a7 7 0 01-8.92 2.5l-3 1.01a1 1 0 01-1.27-1.26l1-3.01A6.97 6.97.0 015 9.1a9 9 0 0010.88 8.7z"/></svg><a href=https://twitter.com/jorgelbg><div><span class=dark>Want to leave a comment?</span>
<span>Drop me a message on Twitter @jorgelbg</span></div></a><section id=sharing><a class=twitter target=_blank href="https://twitter.com/intent/tweet?text=%2f%2fjorgelbg.me%2f2019%2f02%2fdisplay-the-applications-version-in-your-grafana-dashboards%2f - Display%20the%20application%27s%20version%20in%20your%20Grafana%20dashboards by @jorgelbg"><span class=icon-twitter>tweet</span></a></section></footer><ul id=post-list class="archive readmore"><h3>Read more</h3><li><a href=//jorgelbg.me/2020/03/displaying-geohash-tags-from-a-loki-datasource-in-a-grafana-worldmap-panel/><span>Displaying geohash tags from a Loki datasource in a Grafana Worldmap Panel</span><aside class=dates>Mar 18 2020</aside></a></li><li><a href=//jorgelbg.me/2020/02/web-ui-for-testing-dissect-patterns/><span>Web UI for testing dissect patterns</span><aside class=dates>Feb 21 2020</aside></a></li><li><a href=//jorgelbg.me/2020/01/better-url-search-with-elasticsearch/><span>Better URL search with Elasticsearch</span><aside class=dates>Jan 1 2020</aside></a></li></ul><footer id=footer><p class=small>¬© Copyright 2020 Jorge Luis Betancourt</p><p class="small cc">Icons made by
<a href=https://www.freepik.com/ title=Freepik>Freepik</a> from
<a href=https://www.flaticon.com/ title=Flaticon>www.flaticon.com</a> is
licensed by
<a href=https://creativecommons.org/licenses/by/3.0/ title="Creative Commons BY 3.0" target=_blank>CC 3.0 BY</a></p></footer></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-115201846-1','auto');ga('send','pageview');}</script></body></html>